<%
  environment.context_class.instance_eval do
    include Rails.application.routes.url_helpers
  end
%>

(function () {
  "use strict";
  window.Geocoder = function () {
    var myMap;

    var destroyMap = function () {
      if (myMap) {
        myMap.destroy();
        myMap = undefined;
      }
    };

    return {
      ready: function (callback) {
        ymaps.ready(callback)
      },

      buildMap: function (mapContainer, location) {
        var coordinates = location.coordinates ? location.coordinates :
                           [location.latitude, location.longitude],
            addressLine = location.addressLine ? location.addressLine : location.address;
          
        destroyMap();

        myMap = new ymaps.Map(mapContainer, {
          center: coordinates,
          zoom: 14
        }, {searchControlProvider: "yandex#search"});

        var myPlacemark = new ymaps.Placemark(coordinates, {
          balloonContent: addressLine
        });

        myMap.controls.add(new ymaps.control.ZoomControl());
        myMap.geoObjects.add(myPlacemark);

        return myMap;
      },

      destroyMap: destroyMap
    };
  }();
})();
